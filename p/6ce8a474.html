<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><link rel="canonical" href="https://blog.cyfan.top/"><link rel="apple-touch-icon" sizes="76x76" href="https://npm.elemecdn.com/chenyfan-oss@4/512.jpg"><link rel="icon" type="image/png" href="https://npm.elemecdn.com/chenyfan-oss@6.0.0/32.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#F6B352"><meta name="description" content="军训结束,感想不多,就一句话【这就是个无限循环，每天重复训练一套动作，直到结束为止，毫无意义】回家之后我帮父母看店,顺便点开了浏览器,浏览器卡死了30s,终于完全加载出了一个花花绿绿的主页,是大名鼎鼎的2345主页.虽然我很反感这种杂七杂八的傻逼导航,我也试图将主页换成magi或dogedoge,但"><meta name="keywords" content="BLOG,薅羊毛,技术,高中生,DNS,CDN,滑稽,图床"><meta name="author" content="CYF"><title>多域名线程并发与DNS预解析 || 陈YFの博客(￣▽￣)&#34;</title><script>function ranN(e,t){return parseInt(Math.random()*(t-e+1)+e,10)}function loadCSS(t){try{document.createStyleSheet(t)}catch(e){var n=document.createElement("link");n.rel="stylesheet",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}}function loadScript(e,t){var n=document.createElement("script"),a=document.getElementsByTagName("head")[0];n.type="text/javascript",n.charset="UTF-8",n.src=e,n.addEventListener?n.addEventListener("load",function(){t()},!1):n.attachEvent&&n.attachEvent("onreadystatechange",function(){"loaded"==window.event.srcElement.readyState&&t()}),a.appendChild(n)}if(window.setCustom=()=>{},window.mCh={init:()=>{window.messageChannel=new MessageChannel,navigator.serviceWorker.controller.postMessage({type:"INIT"},[messageChannel.port2])},send:a=>new Promise((t,e)=>{const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});navigator.serviceWorker.controller.postMessage({type:"DATA",data:a,id:n}),setTimeout(()=>{e({message:"timeout",ok:!1})},2e3),messageChannel.port1.onmessage=e=>{e.data.id===n&&t({data:e.data.data,ok:!0})}})},"serviceWorker"in navigator){const q=async t=>{navigator.serviceWorker.register("/sw.js?time="+ranN(1,8888888888888889e4)).then(async e=>{t&&(window.localStorage.setItem("ChenBlogHelper_Error","true"),setTimeout(()=>{window.location.search="?time="+ranN(1,8888888888888889e4)},200))}).catch(e=>{console.error(e)})};"true"!=window.localStorage.getItem("ChenBlogHelper_Error")?(window.document.write("稍等,安装Serviceworker..."),window.stop(),q(!0).then()):window.addEventListener("load",async()=>{q(!1).then()})}</script><link rel="stylesheet" href="https://npm.elemecdn.com/chenyfan-os@0.0.0-r1/font_1736178_pjno9b9zyxs.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/notyf@3/notyf.min.css"><script src="https://npm.elemecdn.com/chenyfan-os@0.0.0-r1/utils.min.js"></script><link rel="alternate" href="atom.xml" title="陈YFの博客(￣▽￣)" type="application/atom+xml"></head><style>span.heimu a.external,span.heimu a.external:visited,span.heimu a.extiw,span.heimu a.extiw:visited{color:#252525}.heimu,.heimu a,.heimu a.new,a .heimu{background-color:#252525;color:#252525;text-shadow:none}body:not(.heimu_toggle_on) .heimu.off,body:not(.heimu_toggle_on) .heimu:active,body:not(.heimu_toggle_on) .heimu:hover{transition:color .13s linear;color:#fff}body:not(.heimu_toggle_on) .heimu.off a,body:not(.heimu_toggle_on) .heimu:hover a,body:not(.heimu_toggle_on) a:hover .heimu,body:not(.heimu_toggle_on) a:hover .heimu.off{transition:color .13s linear;color:#add8e6}body:not(.heimu_toggle_on) .heimu.off .new,body:not(.heimu_toggle_on) .heimu.off .new:hover,body:not(.heimu_toggle_on) .new:hover .heimu.off{transition:color .13s linear;color:#ba0000}.container,.container-md,.container-sm{max-width:75rem!important}::-webkit-scrollbar-track-piece{background-color:#f8f8f8}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#ddd;background-clip:padding-box;min-height:28px}::-webkit-scrollbar-thumb:hover{background-color:#bbb}</style><body><header style="height:100vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/" data-letters="陈YFの博客">&nbsp;<strong> 陈YFの博客(￣▽￣)" </strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="../archives/">归档 </a><a class="dropdown-item" href="../categories/">分类 </a><a class="dropdown-item" href="../tags/">标签</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">页面</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="../com/">留言板 </a><a class="dropdown-item" href="../随口胡说/">随口胡说 </a><a class="dropdown-item" href="../about/">关于 </a><a class="dropdown-item" href="../hpp/admin/dash/home">后台</a></div></li><li class="nav-item"><a class="nav-link" href="../links/">朋友们</a></li><li class="nav-item"><a class="nav-link" href="https://cyfan.top">项目主页</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li><li class="nav-item" id="travellings-icon"><a class="nav-link" target="_blank" href="https://travellings.link/">&nbsp;<svg t="1601864448019" class="icon" style="display:unset!important" viewBox="0 0 1159 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="804" width="18" height="18"><path d="M1088.731 85.857c7.486 15.186-0.014 34.184-16.746 42.433L247.459 534.728c-16.735 8.25-36.37 2.625-43.855-12.56-7.485-15.184 0.013-34.183 16.748-42.432l824.525-406.438c16.734-8.248 36.368-2.626 43.854 12.56z" p-id="805" fill="#ffffff"></path><path d="M1067.131 69.833c16.507 3.765 27.377 17.834 24.278 31.421L938.702 770.787c-3.1 13.587-18.995 21.552-35.5 17.786-16.506-3.764-27.374-17.831-24.274-31.42l152.705-669.531c3.098-13.589 18.993-21.553 35.498-17.789z" p-id="806" fill="#ffffff"></path><path d="M1059.32 99.368c12.483 11.436 14.63 29.416 4.79 40.156l-484.802 529.24c-9.84 10.742-27.938 10.176-40.422-1.257-12.483-11.437-14.626-29.413-4.786-40.156L1018.9 98.111c9.839-10.741 27.937-10.177 40.42 1.257zM502.153 622.73c-6.02 16.604-24.36 25.185-40.965 19.166l-240.527-87.19c-16.606-6.02-25.187-24.36-19.168-40.965 6.02-16.605 24.36-25.186 40.965-19.167l240.526 87.192c16.606 6.018 25.187 24.36 19.169 40.964zM937.345 775.375c-6.019 16.605-24.36 25.186-40.966 19.167L655.851 707.35c-16.603-6.019-25.185-24.36-19.165-40.964s24.362-25.185 40.964-19.166l240.528 87.19c16.604 6.02 25.184 24.36 19.167 40.965z" p-id="807" fill="#ffffff"></path><path d="M585.576 911.117c0 17.662-14.318 31.98-31.98 31.98-17.663 0-31.981-14.318-31.981-31.98V655.275c0-17.662 14.318-31.98 31.98-31.98 17.663 0 31.98 14.318 31.98 31.98v255.842z" p-id="808" fill="#ffffff"></path></svg>&nbsp;</a></li><li class="nav-item" id="tton"><a class="nav-link" href="javascript:zh_tran(lololo);">&nbsp;语&nbsp;</a></li><li class="nav-item" id="superlive"><a class="nav-link" id="liveswitch" href="javascript:void(0)">&nbsp;<svg t="1641824272454" class="icon" style="display:unset!important" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1215" width="18" height="18"><path d="M526.336 68.608q91.136 0 171.008 32.768t139.264 89.6 93.696 133.632 34.304 163.84q0 88.064-35.328 164.864t-96.768 134.144q-19.456 21.504-51.2 21.504-22.528 0-41.984-13.312-43.008-27.648-61.952-57.856t-27.648-62.464-12.288-65.536-14.848-66.56-36.352-67.072-76.288-67.584q-25.6-16.384-48.128-24.576t-45.056-14.848-44.032-14.336-45.056-23.552-48.64-41.984-52.736-69.12q25.6-36.864 60.928-65.024t75.264-47.616 81.92-29.184 81.92-9.728zM570.368 545.792q14.336 31.744 19.968 61.44t8.704 57.344 8.704 52.736 20.48 48.128 42.496 44.032 76.8 39.424q3.072 3.072 5.12 11.776t5.12 19.968 9.728 26.112 19.968 30.208q-92.16 22.528-171.008 25.6t-158.72-20.48q9.216-22.528 13.312-40.96t5.12-34.304 0.512-30.208-1.536-29.696q-2.048-29.696-20.992-36.864t-44.032-3.584-50.176 12.288-40.448 10.752q-17.408 3.072-36.352 4.608t-35.328-1.024-26.112-9.728-6.656-22.528q2.048-12.288 4.608-28.672t2.56-33.792-5.632-33.28-19.968-27.136q-6.144-4.096-19.968-10.752t-26.112-14.848-18.432-16.384 3.072-16.384q20.48-15.36 41.984-34.816t32.768-41.984q5.12-10.24 6.144-21.504t-0.512-20.992-3.584-17.408-2.048-12.8-4.096-13.312-8.192-22.528-6.144-35.84 2.048-54.272q-26.624 7.168-37.888 30.72t-7.168 58.368q-16.384-24.576-17.408-45.568t6.656-37.888 22.528-30.208 31.232-22.528q26.624 57.344 57.856 86.016t65.536 43.52 69.12 21.504 68.096 19.968 63.488 39.424 54.784 78.336z" p-id="1216" fill="#ffffff"></path></svg>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://rmt.dogedoge.com/fetch/hi-c-oss/storage/2020-08-24%20204123.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3 post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-08-24 21:08" pubdate>2020年8月24日 晚上</time></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.1k字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 28 分钟 </span><span id="post-meta-views"><i class="iconfont icon-rss"></i> <span id="pv-counter">loading</span> <span>阅读量</span></span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">多域名线程并发与DNS预解析</h1><div class="markdown-body" id="post-body"><p>军训结束,感想不多,就一句话</p><blockquote><p>【这就是个无限循环，每天重复训练一套动作，直到结束为止，毫无意义】</p></blockquote><p>回家之后我帮父母看店,顺便点开了浏览器,浏览器卡死了30s,终于完全加载出了一个花花绿绿的主页,是大名鼎鼎的2345主页.</p><p>虽然我很反感这种杂七杂八的傻逼导航,我也试图将主页换成magi或dogedoge,但是父亲就很不习惯,原因很难以接受:</p><div class="hljs"><pre><code class="hljs undefined">儿子啊，这样我怎么看天气啊。</code></pre></div><p>。。。</p><p>于是我顺手右键点开了源代码，闲着无聊看看，结果却刚看看就找到了好<del>康</del>看的东西：</p><p><img src="https://rmt.dogedoge.com/fetch/hi-c-oss/storage/2020-08-24%20175355.jpg" srcset="https://npm.elemecdn.com/chenyfan-blog@1.0.1/themes/fluid/source/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"https://union2.50bang.org"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//h.2345cdn.net"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//image.2345.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//00imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//01imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//02imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//03imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//04imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//05imgmini.eastday.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//pos.baidu.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//p.tanx.com"</span>&gt;
&lt;link <span class="hljs-attribute">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">"//gma.alicdn.com"</span>&gt;</code></pre></div><p>欸，<code>dns-prefetch</code> 是什么?</p><p>好吧，看起来你我都不懂.</p><h2 id="多并发请求"><a href="#多并发请求" class="headerlink" title="多并发请求"></a>多并发请求</h2><p>请问，一号网页和二号网页哪个加载更快？</p><blockquote><p>假设每张图片的大小为无限小,传输速度为无限大,<code>exmple1.com</code>是 <code>exmple.com</code> 的镜像</p></blockquote><p>一号：</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/1.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/2.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/3.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/4.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/5.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/6.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/7.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/8.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/9.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/10.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/11.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/12.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>二号：</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/1.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/2.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/3.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/4.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/5.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple.com/6.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/7.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/8.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/9.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/10.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/11.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://exmple1.com/12.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>好了公布答案了,很显然<span class="heimu">二</span>号加载更快。</p><p>这时候有人就会问了，凭什么啊！不是说图片无限小吗？右边的反而会增加dns解析时间，难道不会更慢吗？</p><p>好吧好吧，实际上，你以为的加载时间是这样的</p><p><img src="https://rmt.dogedoge.com/fetch/hi-c-oss/storage/2020-08-24%20180740.jpg" srcset="https://npm.elemecdn.com/chenyfan-blog@1.0.1/themes/fluid/source/img/loading.gif" alt></p><p>可是实际上是这样子的：</p><p><img src="https://rmt.dogedoge.com/fetch/hi-c-oss/storage/2020-08-24%20200044.jpg" srcset="https://npm.elemecdn.com/chenyfan-blog@1.0.1/themes/fluid/source/img/loading.gif" alt></p><p>欸这就很有意思了同学们，为什么最后六张会出现Pending状态？</p><p>实际上，浏览器是有并发请求数目限制【通常是2-8个】，虽然这种比较坑人，但这也是为了避免同时大量并发导致资源占用过度，并且只针对同一个域名的（例如向cdn.jsdelivr.net发送请求）。即一时间针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞并进入Pending状态。</p><p>从用户的角度来说，浏览器不可能无限量的并发请求，因此衍生出来了并发限制和HTTP/1.1的Keep alive。 所以，IE6/7在HTTP/1.1下的并发才<strong>2</strong>，但HTTP/1.0却是<strong>4</strong>。 而随着技术的发展，负载均衡和各类NoSQL的大量应用，基本已经足以应对C10K的问题。 但却并不是每个网站都懂得利用domain hash也就是多域名来加速访问。因此，新的浏览器加大了并发数的限制，但却仍控制在8以内。</p><p>然而从服务器的角度来讲，我们也可以窥见，无限制的并发请求无异于一次小型CC，对于保护服务器和优化用户体验还是相当重要的。</p><p>从网站上入手，实际上这一点相当容易理解,2345一打开就是少则五十多张图片同时加载,甚至那些下拉箭头为了兼容ie都还是图片而非fontawesome,如果不绕过并发限制,岂不是一片空白.</p><p>那么问题来了，如何避免堵塞？</p><p>答案显然易见,多换几个域名不就行了??这样图片分别从两个域名获取，直接避免恼火的Pending，</p><p>2345主页中 <code>00imgmini.eastday.com</code> 至 <code>05imgmini.eastday.com</code> 五个域名均是拿来绕开并发限制的。</p><h2 id="Cookie-Free"><a href="#Cookie-Free" class="headerlink" title="Cookie Free"></a>Cookie Free</h2><p>每请求一次资源，就会生成一次新的Cookie。如果网站每个资源cookie有1 KB、网站首页共150个资源时，用户在请求过程中需要发送150 KB的cookie信息，在512 Kbps的常见上行带宽下，需要长达3秒左右才能全部发送完毕。 尽管这个过程可以和页面下载不同资源的时间并发，但毕竟对速度造成了影响。 而且这些信息在js/css/images/html等静态资源上，几乎是没有任何必要的。</p><p>解决方案是启用和主站不同的域名来放置静态资源，也就是cookie free。</p><blockquote><p>注意此处所指的是主域名而非子域名，子域名的Cookie会和主域名共存</p></blockquote><p>但是这样，就孪生出一个极其严重的问题，多个域名，必然会加重<strong>DNS解析时间</strong>和<strong>SSL的握手时间</strong></p><h2 id="避免DNS拥堵"><a href="#避免DNS拥堵" class="headerlink" title="避免DNS拥堵"></a>避免DNS拥堵</h2><p>一旦采用<strong>多域名的方式绕开并发量限制</strong>，就会导致浏览器在请求时必须一个一个解析过去，从<code>00imgmini.eastday.com</code>至<code>05imgmini.eastday.com</code>，然而DNS解析时间虽然短，但是多个解析必然导致严重拖慢速度，此时我们就需要进行预解析。</p><blockquote><p>请注意，预解析在部分主流浏览器中支持，但是并不是所有页面和条件下都支持。</p></blockquote><p>正常情况下打开一个网页，浏览器会做出以下动作：</p><ol><li><p>浏览器向请求网址发起DNS解析</p></li><li><p>浏览器向服务器一个GET请求，拉起进入Pending</p></li><li><p>浏览器解析html，完成初步CSS渲染【此时标题栏显示标题】</p></li><li><p>进行js解析，并请求额外的资源</p></li></ol><p>DNS解析时间的浪费主要阻塞在第四步，为避免解析时间的阻塞，我们采用<code>dns-prefetch</code>进行优化.</p><p>在html头添加</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"x-dns-prefetch-control"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"on"</span> /&gt;</span></code></pre></div><p>向浏览器表明我需要预解析。</p><p>接着【建议】在<code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code> 后添加</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//exmple.com"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"dns-prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"//exmple1.com"</span>&gt;</span></code></pre></div><p>表明强制解析这些域名。并且以后会一直记住这个域名的解析结果直到关闭为止。</p><p>//开始是为了适配 <code>https</code> 和 <code>http</code> 。就是当前请求链接是https ，那么这个//前面自动补充https ，反则补充http 。</p><h1 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h1><p>切记 <code>dns-prefetch</code> 不能滥用，它虽然能一定提升网页打开速度，但也会对浏览器产生一定负担。</p><p>这边的建议是，作为个人，我并不推荐将此方法运用于个人博客。原因很简单，你博客一次能有几张图片？如果你是开图站的，那么这个方法刚好可以运用到你的网站里，只要进行多域名分开并dns欲解析就可以进一步提升网站体验了。</p><p>最后上生肉：</p><blockquote><p>DNS prefetching is an attempt to resolve domain names before a user tries to follow a link. This is done using the computer’s normal DNS resolution mechanism; no connection to Google is used. Once a domain name has been resolved, if the user does navigate to that domain, there will be no effective delay due to DNS resolution time. The most obvious example where DNS prefetching can help is when a user is looking at a page with many links to various domains, such as a search results page. When we encounter hyperlinks in pages, we extract the domain name from each one and resolving each domain to an IP address. All this work is done in parallel with the user’s reading of the page, using minimal CPU and network resources. When a user clicks on any of these pre-resolved names, they will on average save about 200 milliseconds in their navigation (assuming the user hadn’t already visited the domain recently). More importantly than the average savings, users won’t tend to experience the “worst case” delays for DNS resolution, which are regularly over 1 second.</p></blockquote></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="../categories/好方法/">好方法</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="../tags/DNS/">DNS</a> <a class="hover-with-bg" href="../tags/预解析/">预解析</a> <a class="hover-with-bg" href="../tags/优化/">优化</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="eb490c73.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">图床的千层套路</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="4fb070ca.html"><span class="hidden-mobile">CFWorker-ODIndex中文文档&使用教程</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="hpp_comment"><div class="grid__item theme-1"><a href="javascript:onclock();" class="ui-box bottom-rightStart-burst" style="background-color:var(--link-hover-bg-color);font-size:20px">点击加载评论</a></div></div><link rel="stylesheet" href="https://npm.elemecdn.com/chenyfan-os@0.0.0-r1/animated-border.min.css"><script src="https://npm.elemecdn.com/twikoo@1.2.4-beta/dist/twikoo.all.min.js"></script><script>function onclock(){twikoo.init({envId:"blog-comment-6g821sad74db776c",el:"#hpp_comment",region:"ap-shanghai",path:"window.location.pathname"})}</script><style>.el-input-group__prepend{border:1px solid transparent!important}.el-textarea__inner{border:1px solid transparent!important}.el-input__inner{border:1px solid transparent!important}.grid__item{position:relative;display:grid;grid-template-columns:100%;grid-template-rows:100%;justify-items:center;overflow:hidden;padding:4rem 1.5rem;background:var(--color-item-bg)}.grid__item-title{font-size:.85rem;color:var(--color-item-title);align-self:flex-start;margin:0}.action{position:absolute;top:0;right:0;background:0 0;margin:2rem;color:var(--color-action);border:0;padding:0;opacity:0;pointer-events:none}.action:focus{outline:0}.particles-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:5px;border-radius:var(--radius-button);background:var(--color-button-bg);color:var(--color-button-text);border:0;border:var(--border-button);margin:0;padding:1.5rem 3rem;padding:var(--button-padding)}.particles-button:focus{outline:0}.no-js .particles-button{grid-area:1/1/2/2}.particles{position:relative;grid-area:1/1/2/2}.particles-canvas{position:absolute;pointer-events:none;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}.particles-wrapper{position:relative;display:inline-block;overflow:hidden}.theme-1{--color-action:var(--board-bg-color);--color-button-bg:var(--text-color);--color-button-text:#fff;--button-padding:1.5rem 3rem;--radius-button:5px;--border-button:0}</style><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1878991317600808" data-ad-slot="6517667779" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-content mx-auto"><img src="https://npm.elemecdn.com/chenfyan-oss@6.0.3" srcset="https://npm.elemecdn.com/chenyfan-blog@1.0.1/themes/fluid/source/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:40%"></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>由强力的Hexo驱动 | </b></a><i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>由可爱的Fluid支持</b></a> | <a href="https://cyfan.top">由<del>炒鸡NB的</del>CYF书写</a> | 已加入<a href="http://www.foreverblog.cn">十年之约</a> | 部分图片存储于<a href="https://www.dogedoge.com/">DogeDoge图床</a> | 托管于<a href="https://cloudflare.com">CloudFlare</a><br><a class="nav-link" href="/blog-cgi"><b>博客用户端管理</b></a><p id="showsectime"></p><p><b>当前在线用户: <span id="user_count">【未知】</span> | 你的ip: <span id="ip">【未知】</span> | 你的所在国家/地区: <span id="loc">【未知】 </span>| 统计服务器通讯延迟：<span id="delay">【未知】</span></b></p></div><div class="beian"><a href="https://icp.gov.moe" target="_blank">萌ICP备 </a><a href="https://icp.gov.moe/?keyword=20209909" target="_blank">20209909号</a></div></div><style>.live2d{position:fixed;left:-100px;bottom:-20px;width:500px!important;height:437.5px!important;z-index:998;pointer-events:none!important}</style><div id="live2d" class="live2d" style="display:none"><canvas id="live2dm" class="live2d" style="z-index:999!important"></canvas></div></div></footer><script src="https://npm.elemecdn.com/chenyfan-os@0.0.0-r1/lush.js"></script><script src="https://npm.elemecdn.com/notyf@3.10.0/notyf.min.js"></script><script>function loadScript(e,n){var t=document.createElement("script"),o=document.getElementsByTagName("head")[0];t.type="text/javascript",t.charset="UTF-8",t.src=e,t.addEventListener?t.addEventListener("load",function(){n()},!1):t.attachEvent&&t.attachEvent("onreadystatechange",function(){"loaded"==window.event.srcElement.readyState&&n()}),o.appendChild(t)}window.notyf=new Notyf,window.cache_post=async(e,o)=>{const l={len:1,offlen:0},a=(o.innerText=`首页缓存中: ${l.offlen}/`+l.len,o.onclick=null,async e=>new Response(await e.arrayBuffer(),{status:e.status,headers:e.headers}));let n=await(await fetch(e)).text();n=n.match(/(http:\/\/|https:\/\/)((\w|=|\@|\?|\.|\/|&|-)+)/g),l.len=n.length;try{console.log("采用并行请求"),await Promise.all(n.map(async t=>new Promise((n,e)=>{fetch(t).then(a).then(e=>{l.offlen+=1,o.innerText=`资源缓存中: ${l.offlen}/`+l.len,console.log(`资源缓存中: ${l.offlen}/${l.len} | URL: ${t} | 成功`),n()}).catch(e=>{l.offlen+=1,o.innerText=`资源缓存中: ${l.offlen}/`+l.len,console.log(`资源缓存中: ${l.offlen}/${l.len} | URL: ${t} | 失败`),n()})}))),o.innerText="缓存成功√"}catch{for(var t in console.log("并行请求失败，采用串行请求"),n){const c=n[t];fetch(c).then(a).then(e=>{l.offlen+=1,o.innerText=`资源缓存中: ${l.offlen}/`+l.len,console.log(`资源缓存中: ${l.offlen}/${l.len} | URL: ${c} | 成功`)}).catch(e=>{l.offlen+=1,o.innerText=`资源缓存中: ${l.offlen}/`+l.len,console.log(`资源缓存中: ${l.offlen}/${l.len} | URL: ${c} | 失败`)})}}},document.getElementById("liveswitch").addEventListener("click",function(){document.getElementById("live2d")||notyf.error("找不到模型，请使用电脑浏览"),"false"!=window.localStorage.getItem("ChenBlogLive2D")?(window.localStorage.setItem("ChenBlogLive2D","false"),document.getElementById("live2d").style.display="none",notyf.success("Live2D 已关闭")):(window.localStorage.setItem("ChenBlogLive2D","true"),notyf.success("Live2D 已开启")),setTimeout(()=>{window.location.reload()},1e3)}),setTimeout(()=>{window.FPConfig={delay:0,ignoreKeywords:[],maxRPS:3,hoverDelay:50},600<document.body.clientWidth&&"false"!=window.localStorage.getItem("ChenBlogLive2D")&&loadScript("https://npm.elemecdn.com/chenyfan-os@0.0.0-r3/load.js",function(){loadModel(),document.getElementById("live2d").style.display=""})},0),document.onreadystatechange=function(){"complete"==document.readyState&&(loadScript("https://npm.elemecdn.com/chenyfan-os@0.0.0-r1/lazyload.min.js",function(){}),loadScript("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",function(){}))}</script><script src="https://npm.elemecdn.com/tocbot@4.11.1/dist/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:0,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://npm.elemecdn.com/typed.js@2.0.11/lib/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","多域名线程并发与DNS预解析&nbsp;"],cursorChar:"|",typeSpeed:70,loop:!0});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://npm.elemecdn.com/chenyfan-blog@1.0.1/public/js/local-search.js"></script><script>var path="../local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://npm.elemecdn.com/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script>!function(e,a){var r,o=[],t=(e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),i=a.createElement("style");i.type="text/css";try{i.appendChild(a.createTextNode(t))}catch(e){i.styleSheet.cssText=t}a.getElementsByTagName("head")[0].appendChild(i),r="function"==typeof e.onclick&&e.onclick,e.onclick=function(e){var t;r&&r(),(t=a.createElement("div")).className="heart",o.push({el:t,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"}),a.body.appendChild(t)},function e(){for(var t=0;t<o.length;t++)o[t].alpha<=0?(a.body.removeChild(o[t].el),o.splice(t,1)):(o[t].y--,o[t].scale+=.004,o[t].alpha-=.013,o[t].el.style.cssText="left:"+o[t].x+"px;top:"+o[t].y+"px;opacity:"+o[t].alpha+";transform:scale("+o[t].scale+","+o[t].scale+") rotate(45deg);background:"+o[t].color+";z-index:99999");requestAnimationFrame(e)}()}(window,document)</script><script>(async()=>{"setted"!=window.localStorage.getItem("ChenBlogRefferrer")&&(window.localStorage.getItem("ChenBlogRefferrer")?window.localStorage.setItem("ChenBlogRefferrer","setted"):window.localStorage.setItem("ChenBlogRefferrer",document.referrer)),document._onreadystatechange=document.onreadystatechange,document.onreadystatechange=function(){document._onreadystatechange(),"complete"==document.readyState&&setTimeout(()=>{ans={url:window.location.href,ua:navigator.userAgent,resource:[],time:(new Date).getTime(),perform:{paint:{},dom:-1},refferrer:"setted"==window.localStorage.getItem("ChenBlogRefferrer")?document.referrer:window.localStorage.getItem("ChenBlogRefferrer"),memory:{used:window.performance.memory.usedJSHeapSize,total:window.performance.memory.totalJSHeapSize,limit:window.performance.memory.jsHeapSizeLimit}};for(var e of JSON.parse(JSON.stringify(performance.getEntries())))"paint"!=e.entryType?(ans.resource.push({name:e.name,time:{connect:e.connectEnd-e.connectStart,dns:e.domainLookupEnd-e.domainLookupStart,request:e.responseEnd-e.requestStart,response:e.responseEnd-e.responseStart,domcontent:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,loadevent:e.loadEventEnd-e.loadEventStart}}),e.domComplete&&e.domComplete>=ans.perform.dom&&(ans.perform.dom=e.domComplete)):ans.perform.paint[e.name]=e.startTime;mCh.init(),mCh.send(ans).then(e=>e.data).then(e=>{console.log(e),document.getElementById("user_count").innerText=e.user,document.getElementById("ip").innerText=e.ip,document.getElementById("loc").innerText=e.addr,document.getElementById("delay").innerText=e.delay+"ms"})},2e3)}})()</script></body></html>